<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待辦事項清單</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="一個功能完整的待辦事項管理應用">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="待辦事項清單">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#4CAF50">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>待辦事項清單</h1>
        <div class="todo-input">
            <input type="text" id="taskInput" placeholder="添加新的待辦事項...">
            <input type="date" id="taskDate" required>
            <div class="category-input">
                <select id="categorySelect">
                    <option value="" data-default="true">選擇類別</option>
                    <optgroup label="工作" data-default="true">
                        <option value="工作-會議" data-default="true">會議</option>
                        <option value="工作-專案" data-default="true">專案</option>
                        <option value="工作-報告" data-default="true">報告</option>
                        <option value="工作-郵件" data-default="true">郵件</option>
                    </optgroup>
                    <optgroup label="生活" data-default="true">
                        <option value="生活-購物" data-default="true">購物</option>
                        <option value="生活-家務" data-default="true">家務</option>
                        <option value="生活-運動" data-default="true">運動</option>
                        <option value="生活-娛樂" data-default="true">娛樂</option>
                    </optgroup>
                    <optgroup label="學習" data-default="true">
                        <option value="學習-課程" data-default="true">課程</option>
                        <option value="學習-閱讀" data-default="true">閱讀</option>
                        <option value="學習-練習" data-default="true">練習</option>
                    </optgroup>
                    <optgroup label="健康" data-default="true">
                        <option value="健康-醫療" data-default="true">醫療</option>
                        <option value="健康-保養" data-default="true">保養</option>
                    </optgroup>
                    <optgroup label="財務" data-default="true">
                        <option value="財務-繳費" data-default="true">繳費</option>
                        <option value="財務-投資" data-default="true">投資</option>
                    </optgroup>
                    <optgroup label="社交" data-default="true">
                        <option value="社交-聚會" data-default="true">聚會</option>
                        <option value="社交-拜訪" data-default="true">拜訪</option>
                    </optgroup>
                    <optgroup label="旅遊" data-default="true">
                        <option value="旅遊-規劃" data-default="true">規劃</option>
                        <option value="旅遊-預訂" data-default="true">預訂</option>
                    </optgroup>
                    <optgroup label="其他" data-default="true">
                        <option value="其他-雜項" data-default="true">雜項</option>
                    </optgroup>
                    <option value="custom" data-default="true">自定義類別...</option>
                </select>
                <input type="text" id="customCategory" placeholder="輸入自定義類別" style="display: none;">
            </div>
            <button id="addTask">添加</button>
            <button id="showRecurringTaskModal" class="recurring-btn">添加重複任務</button>
        </div>
        
        <!-- 重複任務設置彈窗 -->
        <div id="recurringTaskModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>設置重複任務</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label for="recurringTaskInput">任務內容:</label>
                        <input type="text" id="recurringTaskInput" placeholder="輸入重複任務內容...">
                    </div>
                    
                    <div class="form-group">
                        <label>重複類型:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="recurringType" value="weekly" checked>
                                每週
                            </label>
                            <label>
                                <input type="radio" name="recurringType" value="monthly">
                                每月
                            </label>
                        </div>
                    </div>
                    
                    <div id="weeklyOptions" class="form-group recurring-options">
                        <label>選擇星期幾:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="weekday" value="1"> 星期一</label>
                            <label><input type="checkbox" name="weekday" value="2"> 星期二</label>
                            <label><input type="checkbox" name="weekday" value="3"> 星期三</label>
                            <label><input type="checkbox" name="weekday" value="4"> 星期四</label>
                            <label><input type="checkbox" name="weekday" value="5"> 星期五</label>
                            <label><input type="checkbox" name="weekday" value="6"> 星期六</label>
                            <label><input type="checkbox" name="weekday" value="0"> 星期日</label>
                        </div>
                    </div>
                    
                    <div id="monthlyOptions" class="form-group recurring-options" style="display: none;">
                        <label>選擇每月幾號:</label>
                        <select id="monthDay">
                            <!-- 1-31日 -->
                            <option value="1">1日</option>
                            <option value="2">2日</option>
                            <option value="3">3日</option>
                            <option value="4">4日</option>
                            <option value="5">5日</option>
                            <option value="6">6日</option>
                            <option value="7">7日</option>
                            <option value="8">8日</option>
                            <option value="9">9日</option>
                            <option value="10">10日</option>
                            <option value="11">11日</option>
                            <option value="12">12日</option>
                            <option value="13">13日</option>
                            <option value="14">14日</option>
                            <option value="15">15日</option>
                            <option value="16">16日</option>
                            <option value="17">17日</option>
                            <option value="18">18日</option>
                            <option value="19">19日</option>
                            <option value="20">20日</option>
                            <option value="21">21日</option>
                            <option value="22">22日</option>
                            <option value="23">23日</option>
                            <option value="24">24日</option>
                            <option value="25">25日</option>
                            <option value="26">26日</option>
                            <option value="27">27日</option>
                            <option value="28">28日</option>
                            <option value="29">29日</option>
                            <option value="30">30日</option>
                            <option value="31">31日</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="recurringStartDate">開始日期:</label>
                        <input type="date" id="recurringStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recurringEndDate">結束日期:</label>
                        <input type="date" id="recurringEndDate" required>
                    </div>
                    
                    <div class="modal-buttons">
                        <button id="addRecurringTasks" class="primary-btn">添加任務</button>
                        <button id="cancelRecurringTasks" class="secondary-btn">取消</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="filters">
            <button class="filter active" data-filter="all">全部</button>
            <button class="filter" data-filter="active">未完成</button>
            <button class="filter" data-filter="completed">已完成</button>
        </div>
        <div class="date-filter">
            <label for="filterStartDate">開始日期:</label>
            <input type="date" id="filterStartDate">
            <label for="filterEndDate">結束日期:</label>
            <input type="date" id="filterEndDate">
            <button id="applyDateFilter">套用篩選</button>
            <button id="resetDateFilter">重置</button>
        </div>
        <div class="category-filter">
            <label for="categoryFilter">類別篩選:</label>
            <select id="categoryFilter">
                <option value="">所有類別</option>
            </select>
            <button id="applyCategoryFilter">套用類別篩選</button>
            <button id="resetCategoryFilter">重置類別</button>
        </div>
        <ul id="taskList" class="task-list">
            <!-- 任務將通過JavaScript動態添加 -->
        </ul>
        <div class="todo-footer">
            <span id="taskCount">0 個待辦事項</span>
            <button id="clearCompleted">清除已完成</button>
        </div>
    </div>
    
    <!-- PWA 安裝提示 -->
    <div id="installPrompt" class="install-prompt" style="display: none;">
        <div class="install-content">
            <h3>安裝應用程式</h3>
            <p>將此待辦事項清單安裝到您的裝置，享受更好的使用體驗！</p>
            <div class="install-buttons">
                <button id="installBtn" class="install-btn">安裝</button>
                <button id="dismissBtn" class="dismiss-btn">稍後</button>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
    
    <!-- PWA Service Worker 註冊 -->
    <script>
        // 註冊 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker 註冊成功:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker 註冊失敗:', error);
                    });
            });
        }
        
        // PWA 安裝提示
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // 防止瀏覽器自動顯示安裝提示
            e.preventDefault();
            deferredPrompt = e;
            
            // 顯示自定義安裝提示
            installPrompt.style.display = 'block';
        });
        
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`用戶選擇: ${outcome}`);
                deferredPrompt = null;
                installPrompt.style.display = 'none';
            }
        });
        
        dismissBtn.addEventListener('click', () => {
            installPrompt.style.display = 'none';
            deferredPrompt = null;
        });
        
        // 檢測應用是否已安裝
        window.addEventListener('appinstalled', () => {
            console.log('PWA 已安裝');
            installPrompt.style.display = 'none';
        });
        
        // 檢測是否在獨立模式下運行（已安裝的PWA）
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('應用正在獨立模式下運行');
        }
    </script>
</body>
</html>